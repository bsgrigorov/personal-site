# Analytics & Performance Monitoring

## Overview

| Tool | Purpose |
|------|---------|
| **Google Analytics (GA4)** | User traffic, behavior, acquisition |
| **Vercel Analytics** | Core Web Vitals, real user monitoring |
| **Google Search Console** | SEO, indexing, search performance |

---

## Vercel Analytics (Web Vitals)

Tracks Core Web Vitals (LCP, FID, CLS) with real user data.

> **Free tier** includes Core Web Vitals tracking. Paid tier adds more detailed analytics.

### View Metrics

- **Vercel Dashboard** → Your Project → **Analytics**
- Shows: LCP, FID, CLS scores over time, by page, by device

---

## Google Analytics (GA4)

### Environment Variables

Add these to your `.env.local` (local dev) and **Vercel Environment Variables** (production):

```bash
# GA4 Measurement ID (required for analytics)
NEXT_PUBLIC_GA_TRACKING_ID=G-XXXXXXXXXX

# Google Site Verification (optional - only if using HTML tag verification)
NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION=your-verification-code
```

> ⚠️ **Important:** After changing env vars in Vercel, you must **redeploy** for changes to take effect (static export bakes values at build time).

---

## Google Analytics (GA4)

### Setup

1. Go to [Google Analytics](https://analytics.google.com/analytics/web/)
2. Click **Admin** (gear icon) → **+ Create** → **Property**
3. Name it, set timezone/currency, complete wizard
4. Go to **Admin** → [**Data Streams**](https://analytics.google.com/analytics/web/#/a207536980p286544750/admin/streams/table/) → **Add stream** → **Web**
5. Enter `https://bgrigorov.com`
6. Copy the **Measurement ID** (format: `G-XXXXXXXXXX`)
7. Add to Vercel: **Settings** → **Environment Variables** → `NEXT_PUBLIC_GA_TRACKING_ID`
8. Redeploy

> **Current Property:** The bgrigorov.com GA4 property ID is `a207536980p286544750`

### Verify It's Working

**Option 1: Browser DevTools**
1. Open https://bgrigorov.com
2. DevTools (F12) → **Network** tab → Reload
3. Filter by `gtag` or `google`
4. Look for: `googletagmanager.com/gtag/js?id=G-XXXXXXXXXX`

**Option 2: GA4 Realtime Report**
1. Go to [analytics.google.com](https://analytics.google.com)
2. Select your property
3. **Reports** → **Realtime**
4. Visit your site in another tab - you should appear as an active user

**Option 3: Google Tag Assistant**
1. Install [Tag Assistant](https://tagassistant.google.com/) Chrome extension
2. Visit your site
3. Check that your GA4 tag is detected and firing

### Common Issues

| Issue | Solution |
|-------|----------|
| No data in GA4 | Wait 24-48 hours for processing |
| Tag not loading | Check env var is set in Vercel, redeploy |
| Using `UA-XXXXXXXX` ID | This is old Universal Analytics (deprecated July 2024). Use GA4 `G-XXXXXXXXXX` instead |

---

## Google Search Console

### Setup

1. Go to [Google Search Console](https://search.google.com/search-console)
2. Click **Add property** → Choose **URL prefix**
3. Enter `https://bgrigorov.com`
4. Verify ownership (see methods below)

> **Direct link:** [search.google.com/search-console](https://search.google.com/search-console) - Select `bgrigorov.com` property

### Verification Methods

| Method | How |
|--------|-----|
| **DNS (recommended)** | Add TXT record to your domain's DNS |
| **HTML tag** | Set `NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION` env var |
| **Domain provider** | Cloudflare/Vercel can auto-verify |
| **Google Analytics** | If GA is already set up, this can work |

> If already verified via DNS or domain provider, you don't need the HTML meta tag.

### Submit Sitemap

1. In Search Console, go to **Sitemaps** (left sidebar)
2. Enter: `https://bgrigorov.com/sitemap.xml`
3. Click **Submit**

The sitemap is auto-generated by `app/sitemap.ts` and includes all pages.

### Indexing Issues

Common issues in **Pages** → **Why pages aren't indexed**:

| Issue | Cause | Fix |
|-------|-------|-----|
| **Alternate page with proper canonical** | Google found `/page` and `/page/` | Normal with `trailingSlash: true` - Google will consolidate |
| **Page with redirect** | Non-trailing-slash URLs redirect | Expected behavior, not an error |
| **Soft 404** | Page looks empty to Google | Add more content or check the specific URL |

### Request Indexing

For new/updated pages:
1. Go to **URL Inspection** (top search bar)
2. Enter your page URL
3. Click **Request Indexing**

---

## Quick Reference

### Direct Links

| Resource | URL |
|----------|-----|
| **GA4 Dashboard** | [analytics.google.com](https://analytics.google.com/analytics/web/) |
| **GA4 Data Streams** | [Admin → Data Streams](https://analytics.google.com/analytics/web/#/a207536980p286544750/admin/streams/table/) |
| **Search Console** | [search.google.com/search-console](https://search.google.com/search-console) |
| **Tag Assistant** | [tagassistant.google.com](https://tagassistant.google.com) |
| **Sitemap** | [bgrigorov.com/sitemap.xml](https://bgrigorov.com/sitemap.xml) |
| **Robots.txt** | [bgrigorov.com/robots.txt](https://bgrigorov.com/robots.txt) |

### GA4 Navigation

- **View traffic:** Reports → Acquisition → Traffic acquisition
- **Realtime:** Reports → Realtime
- **Get Measurement ID:** Admin (⚙️) → Data Streams → Click your stream
- **Configure events:** Admin → Events

### Search Console Navigation

- **Performance:** See clicks, impressions, CTR, position
- **Pages:** Check indexing status, see which pages are indexed
- **Sitemaps:** Submit and monitor your sitemap
- **URL Inspection:** Check specific URL status, request indexing

---

## Implementation Details

### Google Analytics Component

```tsx
// src/components/Template/GoogleAnalytics.tsx
import { GoogleAnalytics as NextGoogleAnalytics } from '@next/third-parties/google';

const GoogleAnalytics = () => {
  const gaId = process.env.NEXT_PUBLIC_GA_TRACKING_ID;
  if (!gaId) return null;
  return <NextGoogleAnalytics gaId={gaId} />;
};
```

### Site Verification Meta Tag

Set automatically in `app/layout.tsx` via Next.js metadata:

```tsx
verification: {
  google: process.env.NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION || undefined,
}
```

### Sitemap Generation

Auto-generated by `app/sitemap.ts` using Next.js App Router conventions.

